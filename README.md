# ☁️ go-pg-gqlgen – Full-Stack Multi-Cloud Infra-as-Code + GraphQL API

This project is a **multi-cloud infrastructure orchestration and management backend** built with:

- Go (Golang)
- gqlgen for GraphQL APIs
- PostgreSQL for metadata persistence
- AWS and OCI SDKs for cloud resource provisioning

It programmatically creates cloud infrastructure and exposes a **GraphQL playground** to manage both cloud resources and the relational schema—all with real-time write-back to the database.

---

## 🎯 Project Purpose

This repo simulates a **unified cloud control plane** that allows:

- Declarative creation of AWS/OCI resources (VPCs, EC2, Subnets, etc.)
- Tracking metadata in a PostgreSQL DB
- GraphQL-based CRUD operations via auto-generated schemas
- Infrastructure automation via GraphQL mutations

Ideal for:

- Learning IaC, gqlgen, and Go ORM patterns
- Creating cloud resource catalogs
- Building internal developer platforms (IDPs)

---

## 📦 Features

- ✅ Provision VPC, Subnet, Route Table, EC2, EIP, Security Groups
- ✅ Auto-generate GraphQL schema and resolvers using gqlgen
- ✅ ORM-backed models for PostgreSQL
- ✅ GraphQL Playground for CRUD + Infra provisioning
- ✅ AWS and OCI resource composition libraries
- ✅ REST-like GraphQL mutations for managing cloud infrastructure

---

## 🧱 Project Structure

```
.
├── awscompose/               # AWS-specific resource creation (VPC, EC2, Subnet, etc.)
├── ocicompose/               # OCI-specific resource modules (VCN, Compartment, etc.)
├── graph/                    # gqlgen schema, resolvers, models
│   ├── schema.graphqls       # GraphQL schema
│   ├── schema.resolvers.go   # Manual resolvers
│   ├── generated.go          # Auto-generated by gqlgen
│   ├── db.go                 # DB connection
├── server.go                 # App entry point
├── script.sql                # PostgreSQL schema
├── samplequeries.txt         # Sample GraphQL mutations & queries
├── go.mod / go.sum           # Module dependencies
├── .env                      # Environment config
└── gqlgen.yml                # gqlgen configuration
```

---

## 🚀 How to Run

### Prerequisites

- Go 1.18+
- PostgreSQL running locally
- AWS credentials configured (`~/.aws/credentials`)
- Optional: OCI config (`~/.oci/config`)

### Setup & Start

```bash
git clone https://github.com/paihari/go-pg-gqlgen.git
cd go-pg-gqlgen

# Set Go module mode
export GO111MODULE=on

# Run the server
go run ./server.go
```

Open browser: [http://localhost:8080](http://localhost:8080)

You’ll see the **GraphQL Playground**.

---

## ✨ Sample Query

```graphql
mutation {
  createVpc(input: {
    name: "test-vpc"
  }) {
    id
    name
  }
}
```

More examples in [`samplequeries.txt`](./samplequeries.txt)

---

## 🔄 Supported Tables & Cloud Resources

| Table                     | GQL CRUD | Cloud Provisioning |
|---------------------------|----------|---------------------|
| domains, classes, stages  | ✅ Yes   | ❌ No              |
| buckets, dbs, backups     | ✅ Yes   | ✅ Yes             |
| vpcs, subnets, gateways   | ✅ Yes   | ✅ Yes             |
| security groups, eip, EC2 | ✅ Yes   | ✅ Yes             |

---

## ⚙️ Infra Flow (AWS)

1. Create VPC → Internet Gateway → Route Table → Subnet
2. Create Security Group → Network Interface → Elastic IP
3. Launch EC2 Instance (Ubuntu)
4. Configure Apache inside instance

---

## 🧩 Next Steps

- 🐳 Dockerize & deploy
- 🧪 Unit tests for resolvers
- 🌐 OCI extension: Automate VCN and compartments
- 🔐 Add RBAC for GraphQL queries

---

## 📘 References

- gqlgen: https://gqlgen.com/
- AWS SDK Go v2: https://aws.github.io/aws-sdk-go-v2/
- OCI Go SDK: https://docs.oracle.com/en-us/iaas/tools/go-sdk.html

---

## ✍️ Author

Built by [@paihari](https://github.com/paihari) – enabling full-stack, multi-cloud infrastructure orchestration with GraphQL and Go.
